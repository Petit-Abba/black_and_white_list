# 版本更新信息

### v5.4.0 (23/05/08)

- 修复触发白名单次数统计失败的问题。
- 修改优化部分代码，提高效率。
- 简化配置文件配置逻辑。
- 完善unistall.sh脚本，卸载更彻底。
- 加入自定义跳过大文件功能 (安全模式)
- `开启后在黑名单中会自动跳过超过设定体积大小的文件。
  防止设置黑名单路径时删除可能的个人文件。
  但可能会拖慢运行速度，因为要用"find"命令。`
- 修改危险通配符判断方式。
- 例如`/data/media/0/*`这种危险通配符不会执行；
- 必须填写成`/data/media/0/&*`才会执行清理操作；
- 此修改涵盖所有以`/*`结尾的规则，请统一修改成以`/&*`结尾。
- **修改者：@焕晨**

```
# 黑名单列表通配符拓展
blacklist_wildcard_list() {
  local IFS=$'\n'
  grep -v '#' <"$Black_List" | while read -r bl; do
    if [[ "${bl: -2}" == "/*" ]]; then
      logd "检测到/*，请替换成/&*"
      logd "[pass] -跳过：$bl"
      continue
    fi
    #把/&*替换成/*
    if [[ "${bl: -2}" == "&*" ]]; then
      bl=${bl//\/&\*/\/\*}
    fi
    if [[ -n "$bl" ]]; then
      if [[ $skip_mb != -1 ]]; then
        big=$(find $bl -size +"$skip_mb"M 2>/dev/null)
        if [[ $big != "" ]] && [[ -d $bl ]]; then
          if [[ "${bl: -1}" == "/" ]]; then
            bl="$bl*"
          elif [[ "${bl: -1}" != "*" ]]; then
            bl="$bl/*"
          fi
        fi
      fi
      for i in $bl; do
        if [[ $i == "$big" ]]; then
          logd "[big] -跳过：$i"
          continue
        else
          echo "$i"
        fi
      done
    fi
  done
}

```

### v5.3.5 (23/05/05)

- 适配ksu。
- 修改模块内置定时设置。
- 修改代码并添加大量注释。
- 去除部分功能提高运行速度。
- `去除了支持在需要删除的文件夹中添加"black"文件，脚本运行时会自动将该路径添加至黑名单
  的功能。因为每次要遍历/data/media/耗时耗力，而且几乎无人使用。`
- 支持间隔更长时间进行清理。
- 精简模块体积：
- `放弃内置busybox`
- `放弃支持Magisk Lite`
- 去除音量键选择。
- `因为部分设备音量键选择存在bug。`
- **修改者：@焕晨**

### v4.4.4 (21/10/09)

- 🤔刷新版本号

### v4.4.3 (21/10/05)

- 白名单规则追加更新
- 细节处理

### v4.4.2 (21/10/03)

- 使用了`/路径/.*/`结尾和`/路径/..*/`结尾的规则存在漏洞，已经修复。

```
case $i in 
  *'/.') continue ;; 
  *'/./') continue ;; 
  *'/..') continue ;; 
  *'/../') continue ;; 
esac
```

### v4.4.1 (21/10/03)

- black特性更改: `find /data/ ..` --> `find /data/media/ ..`
  ，将查找/data/目录下所有目录更改为/data/media/用户存储，因为正常情况下不会去其他目录创建black文件，这么更改可以减少资源浪费。

### v4.4.0 (21/10/03)

- 减少一处函数: ~while raed(){}~ 因为可以用`IFS=$'\n' --重新定义字段分隔符 忽略空格和制表符` 代替WhileRead识别空格文件和文件夹。
- 速度提升40％: 因为移除了上面函数，减少重复判断，执行脚本速度更快，当然每次执行脚本时间大约是1秒。
- 白名单/黑名单.prop: 优化通配符判断
- 关于之前版本被清空目录: 问题已经找到，用户使用了`/路径/.*`规则，系统识别为`/路径/.`和`/路径/..`，`.`
  在脚本中代表目录的意思，所以会被清除，现已做默认跳过处理:`case $i in *'/.') continue ;; *'/..') continue ;; esac`
  ，不会再判断上述情况，可以放心使用！
- 优化脚本代码
- ~内置busybox~

### v4.3.2 (21/10/02)

- 更新调用crond命令判断，使安卓11以下设备正常使用。

### v4.3.1 (21/10/02)

-

修复自定义定时不生效问题 `alias crond="${MODDIR}/script/bin/busybox/crond"` --> `alias crond="$(magisk --path)/.magisk/busybox/crond"`

### v4.3.0 (21/10/02)

- 修复: 第一次刷入模块后重启模块不工作(原因竟然是我写错了busybox/bash路径)。
- 修复: 一处小bug `/路径/.`和`/路径/..` 已修复
- 更改: 重启设备启动脚本初始化完成立即运行一次清理脚本，使模块更快正常显示，解除用户以为:`这是不是没生效`的疑惑。
- 更改: 刷模块时去除了多余的选择，只给一个: `保留所有原模块数据`或`全部清除`。
- 优化: 脚本判断，减少资源浪费。
- 新增: 重启设备重置日志的打印内容: 显示当前定时状态，如 `24H 每隔${minute}分钟运行一次`。
- 新增机制: 跳过白名单次数`大于3次`后不再打印显示，停止无用输出浪费页面显示。

### v4.2.0 (21/10/01)

- 支持用户自定义定时时间: 可以在`/sdcard/Android/clear_the_blacklist/定时任务`文件夹中编辑`定时设置.ini`
  文件，编辑完成后保存，以`root方式执行`在同一目录下的`Run_cron.sh`脚本即可完成自定义定时。
- 重新开启: 支持在需要删除的文件夹中添加`black`文件，脚本运行时会自动将该路径添加至黑名单.prop内的`#black标识符`
  下方，`#black标识符可以更改至任意行`，但`不能删除或重复输入多个#black标识符`。
-

刷入模块过程添加询问: `1.发现模块记录文件(清理数量统计)是否保留` `2.发现模块自定义定时运行文件是否保留(如果有)` `3.询问是否删除/sdcard/Android/clear_the_blacklist文件夹重建(如果有)`

- 修复刷入模块后一直显示`请等待刷新`的问题
- 内置`busybox` (踩坑里了！由于移除了内置busybox，系统busybox/for与Magisk busybox/for 命令不够完善，导致无法正确识别`*`
  通配符，至使用户使用`*`通配符判断时将所有目录删除！对此我十分难过和内疚，向大家说句抱歉😔)，目前busybox已重新内置并正常使用。
- ~Android 9+~ (移除判断，待进一步测试是否支持内置busybox)
- ..

### v4.0.0-4.1.0 (21/09/30) Pre-release

- 更新: 支持用户自定义定时时间: 可以在`/sdcard/Android/clear_the_blacklist/定时任务`文件夹中编辑`定时设置.ini`
  文件，编辑完成后保存，以`root方式执行`在同一目录下的`Run_cron.sh`脚本即可完成自定义定时。
- 更新: 支持在需要删除的文件夹中添加`black`文件，脚本运行时会自动将该路径添加至黑名单.prop内的`#black标识符`下方，`#black标
  识符可以更改至任意行`，但`不能删除或重复输入多个#black标识符`。
- 优化脚本判断
-

刷入模块过程添加询问: `1.发现模块记录文件(清理数量统计)是否保留` `2.发现模块自定义定时运行文件是否保留(如果有)` `3.询问是否删除/sdcard/Android/clear_the_blacklist文件夹重建(如果有)`

- 修复刷入模块后一直显示`请等待刷新`的问题
- ~内置busybox~
- ~Android 9+~
- ..

### v3.3.0 (21/09/29)

- 修复数量统计问题
- ..

### v3.2.1 (21/09/29)

- 继`循环吃掉乱拉屎的文件/文件夹`模块，改进大部分不足，优化代码内容，添加功能，重命名为 *清理黑名单列表*。
- 支持白名单
- 支持空格路径或文件: `/sdcard/123 456`
- 支持通配符: `*`
- 循环体改为`crond定时`
- 内置busybox
- 日志生成
- ..
